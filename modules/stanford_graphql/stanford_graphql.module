<?php

/**
 * @file
 * stanford_graphql.module
 */

use Drupal\graphql\GraphQL\Execution\FieldContext;
use Drupal\graphql_compose\Plugin\GraphQLCompose\GraphQLComposeFieldTypeInterface;

/**
 * Implements hook_graphql_compose_field_results_alter().
 */
function stanford_graphql_graphql_compose_field_results_alter(array &$results, $entity, GraphQLComposeFieldTypeInterface $plugin, FieldContext $context) {
  $field_definition = $plugin->getFieldDefinition();
  if ($field_definition->getName() == 'layout_selection') {
    foreach ($results as &$result) {
      $result = [
        'id' => $results->id(),
        'label' => $results->label(),
      ];
    }
  }

  if ($field_definition->getType() == 'viewfield') {
    /** @var \Drupal\views\ViewExecutable $result */
    foreach ($results as $result) {
      // Change the view display to use the graphql that should match the chosen
      // view.
      $result->setDisplay($result->current_display . '_graphql');
    }
  }
}
